/**
 * Frameworks datasource.
 *
 * This module is compatible with core/form-autocomplete.
 *
 * @module     tool_lp/frameworks_datasource
 * @copyright  2016 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("pulseaction_notification/chaptersource",["jquery","core/ajax","core/notification","core/modal_factory","core/fragment","core/str","core/modal_events"],(function($,Ajax,Notification,ModalFactory,Fragment,Str,ModalEvents){const previewModalBody=function(contextID){let userid=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(void 0!==window.tinyMCE)var params={contentheader:window.tinyMCE.get("id_pulsenotification_headercontent_editor").getContent(),contentstatic:window.tinyMCE.get("id_pulsenotification_staticcontent_editor").getContent(),contentfooter:window.tinyMCE.get("id_pulsenotification_footercontent_editor").getContent(),userid:userid};else params={contentheader:document.querySelector("#id_pulsenotification_headercontent_editoreditable").innerHTML,contentstatic:document.querySelector("#id_pulsenotification_staticcontent_editoreditable").innerHTML,contentfooter:document.querySelector("#id_pulsenotification_footercontent_editoreditable").innerHTML,userid:userid};var dynamicparams={};if(null!==document.querySelector("[name=pulsenotification_dynamiccontent]")){dynamicparams={contentdynamic:document.querySelector("[name=pulsenotification_dynamiccontent]").value,contenttype:document.querySelector("[name=pulsenotification_contenttype]").value,chapterid:document.querySelector("[name=pulsenotification_chapterid]").value,contentlength:document.querySelector("[name=pulsenotification_contentlength]").value};var form=document.forms["pulse-automation-template"],formdata=new FormData(form),formData={formdata:formdata=new URLSearchParams(formdata).toString()}}return Fragment.loadFragment("pulseaction_notification","preview_content",contextID,{...params,...dynamicparams,...formData})};return{processResults:function(selector,modules){return modules},transport:function(selector,query,success,failure){var mod=document.querySelector("#id_pulsenotification_dynamiccontent");Ajax.call([{methodname:"pulseaction_notification_get_chapters",args:{mod:mod.value}}])[0].then((function(result){success(result)})).fail(failure)},updateChapter:function(){const SELECTORS_chaperType="#id_pulsenotification_contenttype",SELECTORS_mod="#id_pulsenotification_dynamiccontent";document.querySelector(SELECTORS_chaperType).addEventListener("change",(e=>resetChapter())),document.querySelector(SELECTORS_mod).addEventListener("change",(e=>resetChapter()));var chapter=document.querySelector("#id_pulsenotification_chapterid");function resetChapter(){chapter.innerHTML="",chapter.value="";var event=new Event("change");chapter.dispatchEvent(event)}},previewNotification:function(contextid){var btn=document.querySelector('[name="pulsenotification_preview"]');null!==btn&&btn.addEventListener("click",(function(){var contextID;contextID=contextid,ModalFactory.create({title:Str.get_string("preview","pulseaction_notification"),body:previewModalBody(contextID),large:!0}).then((modal=>{modal.show(),modal.getRoot().on(ModalEvents.bodyRendered,(function(){modal.getRoot().get(0).querySelector("[name=userselector]").addEventListener("change",(e=>{e.preventDefault();var target=e.target;modal.setBody(previewModalBody(contextID,target.value))}))}))}))}))},reportModal:function(contextID){var btn=document.querySelectorAll('[data-target="view-content"]');null!==btn&&btn.forEach((element=>{element.addEventListener("click",(function(e){var target=e.target.closest("a"),instance=target.dataset.instanceid,userid=target.dataset.userid;!function(contextID,instance,userid){var params={instanceid:instance,userid:userid};ModalFactory.create({title:Str.get_string("preview","pulseaction_notification"),body:Fragment.loadFragment("pulseaction_notification","preview_instance_content",contextID,params),large:!0}).then((modal=>{modal.show()}))}(contextID,instance,userid)}))}))}}}));

//# sourceMappingURL=chaptersource.min.js.map